name: dev pull requests

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [dev]

permissions:
  contents: read
  issues: write

jobs:
  tests:
    uses: ./.github/workflows/test-reusable.yml

  check-actor:
    name: check who is author
    needs: tests
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    outputs:
      is_author: ${{ steps.setflag.outputs.is_author }}
    steps:
      - name: Check who is the author
        id: setflag
        run: |
          # VERVANG 'JOUW_GITHUB_NAAM' door je eigen username
          if [ "${{ github.actor }}" == "lottesaye" ]; then
            echo "is_author=true" >> $GITHUB_OUTPUT
          else
            echo "is_author=false" >> $GITHUB_OUTPUT
          fi

  notify-owner:
    name: Notify Owner
    needs: check-actor
    if: github.event.action == 'opened' && needs.check-actor.outputs.is_author == 'false'
    runs-on: ubuntu-latest
    steps:
      - name: Create GitHub issue
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸš¨ Onbevoegde PR gedetecteerd door ${context.actor}`,
              body: `Iemand anders probeert code naar de dev branch te sturen.`,
              assignees: ['lottesaye']
            });
